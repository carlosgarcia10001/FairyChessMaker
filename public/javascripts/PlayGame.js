var move = require('./Move')
var fs = require('fs')
var piece = require('./Piece')
var indexAndCoordinates = require('./IndexAndCoordinates')
var pieces = piece.createPieces()
var cleanPieceFileRead = require('./CleanPieceFileRead')
var game = require('./Game')
var board = new Array(128)
var htmlBoardControl = require('./htmlBoardControl')
var boardState = require('./BoardState')
game.initializeBoard(board)

$(document).ready(function(){
    var htmlSquares = []
    var locateHtmlSquares = {}
    $(document).on('load',function(){
        htmlSquares = htmlBoardControl.createHtmlSquares()
        locateHtmlSquares = htmlBoardControl.createLocateHtmlSquares(htmlSquares)
        var pieceData = {"wK":{"id":"k","color":"w","hp":"1","dmg":"1","atttype":"traitor","mov":["-17","17","-1","1","15","-15","16","-16"],"movdur":["1","1","1","1","1","1","1","1"],"dmgmov":["-17","17","-1","1","15","-15","16","-16"],"dmgmovdur":["1","1","1","1","1","1","1","1"]},"wQ":{"id":"q","color":"w","hp":"1","dmg":"1","atttype":"normal","mov":["-16","16","-32","32","-48","48","-64","64","-80","80","-96","96","-112","112","-15","15","-30","30","-45","45","-60","60","-75","75","-90","90","-105","105","1","-1","2","-2","3","-3","4","-4","5","-5","6","-6","7","-7","17","-17","34","-34","51","-51","68","-68","85","-85","102","-102","119","-119"],"movdur":["1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1"],"dmgmov":["-16","16","-32","32","-48","48","-64","64","-80","80","-96","96","-112","112","-15","15","-30","30","-45","45","-60","60","-75","75","-90","90","-105","105","1","-1","2","-2","3","-3","4","-4","5","-5","6","-6","7","-7","17","-17","34","-34","51","-51","68","-68","85","-85","102","-102","119","-119"],"dmgmovdur":["1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1"]},"wR":{"id":"r","color":"w","hp":"1","dmg":"1","atttype":"normal","mov":["1","-1","2","-2","3","-3","4","-4","5","-5","6","-6","7","-7","-16","16","-32","32","-48","48","-64","64","-80","80","-96","96","-112","112"],"movdur":["1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1"],"dmgmov":["1","-1","2","-2","3","-3","4","-4","5","-5","6","-6","7","-7","-16","16","-32","32","-48","48","-64","64","-80","80","-96","96","-112","112"],"dmgmovdur":["1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1"]},"wB":{"id":"b","color":"w","hp":"1","dmg":"1","atttype":"normal","mov":["-15","15","-30","30","-45","45","-60","60","-75","75","-90","90","-105","105","17","-17","34","-34","51","-51","68","-68","85","-85","102","-102","119","-119"],"movdur":["1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1"],"dmgmov":["-15","15","-30","30","-45","45","-60","60","-75","75","-90","90","-105","105","17","-17","34","-34","51","-51","68","-68","85","-85","102","-102","119","-119"],"dmgmovdur":["1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1"]},"wN":{"id":"n","color":"w","hp":"1","dmg":"1","atttype":"normal","mov":["-31","31","-14","14","18","-18","33","-33"],"movdur":["1","1","1","1","1","1","1","1"],"dmgmov":["-31","31","-14","14","18","-18","33","-33"],"dmgmovdur":["1","1","1","1","1","1","1","1"]},"wP":{"id":"p","color":"w","hp":"1","dmg":"1","atttype":"normal","mov":["-16","-80","-96","-112"],"movdur":["1","1","1","1"],"dmgmov":["-16","-80","-96","-112"],"dmgmovdur":["1","1","1","1"]},"bK":{"id":"K","color":"b","hp":"1","dmg":"1","atttype":"normal","mov":["-17","17","-1","1","15","-15","16","-16"],"movdur":["1","1","1","1","1","1","1","1"],"dmgmov":["-17","17","-1","1","15","-15","16","-16"],"dmgmovdur":["1","1","1","1","1","1","1","1"]},"bQ":{"id":"Q","color":"b","hp":"1","dmg":"1","atttype":"normal","mov":["-1","1","-2","2","-3","3","-4","4","-5","5","-6","6","-7","7","-17","17","-34","34","-51","51","-68","68","-85","85","-102","102","-119","119","-15","15","-30","30","-45","45","-60","60","-75","75","-90","90","-105","105","-16","16","-32","32","-48","48","-64","64","-80","80","-96","96","-112","112"],"movdur":["1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1"],"dmgmov":["-1","1","-2","2","-3","3","-4","4","-5","5","-6","6","-7","7","-17","17","-34","34","-51","51","-68","68","-85","85","-102","102","-119","119","-15","15","-30","30","-45","45","-60","60","-75","75","-90","90","-105","105","-16","16","-32","32","-48","48","-64","64","-80","80","-96","96","-112","112"],"dmgmovdur":["1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1"]},"bR":{"id":"R","color":"b","hp":"1","dmg":"1","atttype":"normal","mov":["-16","16","-32","32","-48","48","-64","64","-80","80","-96","96","-112","112","1","-1","2","-2","3","-3","4","-4","5","-5","6","-6","7","-7"],"movdur":["1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1"],"dmgmov":["-16","16","-32","32","-48","48","-64","64","-80","80","-96","96","-112","112","1","-1","2","-2","3","-3","4","-4","5","-5","6","-6","7","-7"],"dmgmovdur":["1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1"]},"bB":{"id":"B","color":"b","hp":"1","dmg":"1","atttype":"normal","mov":["-15","15","-30","30","-45","45","-60","60","-75","75","-90","90","-105","105","-17","17","-34","34","-51","51","-68","68","-85","85","-102","102","-119","119"],"movdur":["1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1"],"dmgmov":["-15","15","-30","30","-45","45","-60","60","-75","75","-90","90","-105","105","-17","17","-34","34","-51","51","-68","68","-85","85","-102","102","-119","119"],"dmgmovdur":["1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1"]},"bN":{"id":"N","color":"b","hp":"1","dmg":"1","atttype":"normal","mov":["-31","31","-14","14","18","-18","33","-33"],"movdur":["1","1","1","1","1","1","1","1"],"dmgmov":["-31","31","-14","14","18","-18","33","-33"],"dmgmovdur":["1","1","1","1","1","1","1","1"]},"bP":{"id":"P","color":"b","hp":"1","dmg":"1","atttype":"normal","mov":["-16"],"movdur":["1"],"dmgmov":["-16"],"dmgmovdur":["1"]}}
        pieces = pieceData
        cleanPieceFileRead.cleanPieces(pieces)
        pieces['bR'].atttype = 'friendlyfire'
        console.log(pieces)
        game.parseFEN(board, 'rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR', pieces)
    })
    
    var config = {
        pieceTheme: "../images/chesspieces/wikipedia/{piece}.png",
        draggable: true,
        position: "start",
        onMouseoverSquare: onMouseoverSquare,
        onDrop: onDrop
    }

    function onMouseoverSquare(square, piece){
        if(piece==false){
            htmlBoardControl.unHighlightValidMoves(htmlSquares)
        }
        else{
            htmlBoardControl.updateHighlightedMoves(board,square,htmlSquares,locateHtmlSquares)
        }
    }

    function onDrop(source, target, piece){
        var movement = move.makeMove(board, 'w', source, target)
        console.log(boardState.printBoard(board))
        if(movement == false){
            return 'snapback'
        }

    }
    var htmlBoard = Chessboard('myBoard',config)
    $(document).trigger('load')
})